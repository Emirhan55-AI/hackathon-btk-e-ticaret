# Nginx configuration for Aura AI System Monitor
# Provides centralized logging and system health monitoring interface
# Serves as a simple dashboard for all AI services

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # Custom log format for detailed request tracking
    log_format aura_combined '$remote_addr - $remote_user [$time_local] '
                           '"$request" $status $body_bytes_sent '
                           '"$http_referer" "$http_user_agent" '
                           'rt=$request_time uct="$upstream_connect_time" '
                           'uht="$upstream_header_time" urt="$upstream_response_time"';
    
    # Main server configuration
    server {
        listen 80;
        server_name localhost;
        
        # Enable gzip compression for better performance
        gzip on;
        gzip_vary on;
        gzip_min_length 10240;
        gzip_proxied expired no-cache no-store private must-revalidate no_last_modified no_etag auth;
        gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;
        
        # Custom error pages
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        # Main monitoring dashboard
        location / {
            return 200 '
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåü Aura AI System Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { 
            background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px);
            border-radius: 15px; 
            padding: 25px; 
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); }
        .card h3 { margin-bottom: 15px; font-size: 1.3em; }
        .service-link { 
            display: block; 
            color: #fff; 
            text-decoration: none; 
            padding: 10px 15px; 
            background: rgba(255,255,255,0.1);
            border-radius: 8px; 
            margin: 8px 0;
            transition: background 0.3s ease;
        }
        .service-link:hover { background: rgba(255,255,255,0.2); }
        .status { font-size: 0.9em; opacity: 0.8; }
        .footer { text-align: center; margin-top: 40px; opacity: 0.7; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Aura AI System Monitor</h1>
            <p>Advanced AI-Powered E-Commerce Platform - BTK Hackathon 2025</p>
            <div class="status">System Status: All Services Running</div>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3>üõí E-Commerce Platform</h3>
                <a href="http://localhost:8000" class="service-link" target="_blank">
                    Main Platform (Port 8000)
                </a>
                <a href="http://localhost:8000/docs" class="service-link" target="_blank">
                    API Documentation
                </a>
                <p>Complete shopping platform with user management, products, and orders</p>
            </div>
            
            <div class="card">
                <h3>ü§ñ AI Orchestrator</h3>
                <a href="http://localhost:8006" class="service-link" target="_blank">
                    AI Coordinator (Port 8006)
                </a>
                <a href="http://localhost:8006/docs" class="service-link" target="_blank">
                    AI API Documentation
                </a>
                <p>Central coordination hub for all AI services and workflows</p>
            </div>
            
            <div class="card">
                <h3>üëÅÔ∏è Computer Vision AI</h3>
                <a href="http://localhost:8001" class="service-link" target="_blank">
                    Image Analysis (Port 8001)
                </a>
                <a href="http://localhost:8001/docs" class="service-link" target="_blank">
                    Vision API Docs
                </a>
                <p>Advanced clothing analysis using ResNet-50, ViT, and CLIP models</p>
            </div>
            
            <div class="card">
                <h3>üí¨ Language AI</h3>
                <a href="http://localhost:8002" class="service-link" target="_blank">
                    NLU Service (Port 8002)
                </a>
                <a href="http://localhost:8002/docs" class="service-link" target="_blank">
                    Language API Docs
                </a>
                <p>Multilingual understanding with XLM-R transformer (100+ languages)</p>
            </div>
            
            <div class="card">
                <h3>üë§ Style Profiler</h3>
                <a href="http://localhost:8003" class="service-link" target="_blank">
                    Style Analysis (Port 8003)
                </a>
                <a href="http://localhost:8003/docs" class="service-link" target="_blank">
                    Style API Docs
                </a>
                <p>Advanced user style profiling with ML clustering and analytics</p>
            </div>
            
            <div class="card">
                <h3>‚ú® Combination Engine</h3>
                <a href="http://localhost:8004" class="service-link" target="_blank">
                    Outfit Generator (Port 8004)
                </a>
                <a href="http://localhost:8004/docs" class="service-link" target="_blank">
                    Combination API Docs
                </a>
                <p>Intelligent outfit combinations using graph algorithms</p>
            </div>
            
            <div class="card">
                <h3>üéØ Recommendations</h3>
                <a href="http://localhost:8005" class="service-link" target="_blank">
                    FAISS Engine (Port 8005)
                </a>
                <a href="http://localhost:8005/docs" class="service-link" target="_blank">
                    Recommendation API
                </a>
                <p>Ultra-fast product recommendations with FAISS similarity search</p>
            </div>
            
            <div class="card">
                <h3>üß† Learning AI</h3>
                <a href="http://localhost:8007" class="service-link" target="_blank">
                    Feedback Loop (Port 8007)
                </a>
                <a href="http://localhost:8007/docs" class="service-link" target="_blank">
                    Learning API Docs
                </a>
                <p>Intelligent feedback processing and continuous system learning</p>
            </div>
        </div>
        
        <div class="footer">
            <p>üöÄ Built for BTK Hackathon 2025 | Complete AI-Powered Fashion Platform</p>
            <p>System initialized at: ' + (new Date()).toLocaleString() + '</p>
        </div>
    </div>
    
    <script>
        // Auto-refresh status every 30 seconds
        setInterval(() => {
            fetch("/health").then(r => {
                if (r.ok) {
                    document.querySelector(".status").innerHTML = "System Status: ‚úÖ All Services Healthy";
                } else {
                    document.querySelector(".status").innerHTML = "System Status: ‚ö†Ô∏è Some Services Degraded";
                }
            }).catch(() => {
                document.querySelector(".status").innerHTML = "System Status: ‚ùå Monitoring Unavailable";
            });
        }, 30000);
    </script>
</body>
</html>
            ';
            add_header Content-Type text/html;
        }
        
        # Health check endpoint for the monitor itself
        location /health {
            return 200 '{"status":"healthy","services":8,"timestamp":"' + $time_iso8601 + '"}';
            add_header Content-Type application/json;
        }
        
        # Proxy to e-commerce backend for health checks
        location /api/backend/health {
            proxy_pass http://backend:8000/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # Proxy to AI orchestrator for health checks
        location /api/ai/health {
            proxy_pass http://orchestrator-service:8006/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # Log aggregation endpoint (serves log files)
        location /logs/ {
            alias /var/log/aura/;
            autoindex on;
            autoindex_exact_size off;
            autoindex_localtime on;
            
            # Basic authentication for log access (optional)
            # auth_basic "Aura AI Logs";
            # auth_basic_user_file /etc/nginx/.htpasswd;
        }
        
        # Static assets and resources
        location /static/ {
            root /var/www/html;
            expires 1d;
            add_header Cache-Control "public, immutable";
        }
        
        # Error page handling
        location = /404.html {
            return 404 '
<!DOCTYPE html>
<html><head><title>404 - Not Found</title></head>
<body style="font-family: Arial; text-align: center; padding: 50px;">
<h1>üîç 404 - Page Not Found</h1>
<p>The requested resource was not found on the Aura AI system.</p>
<a href="/">‚Üê Back to System Monitor</a>
</body></html>
            ';
            add_header Content-Type text/html;
        }
        
        location = /50x.html {
            return 500 '
<!DOCTYPE html>
<html><head><title>500 - System Error</title></head>
<body style="font-family: Arial; text-align: center; padding: 50px;">
<h1>‚ö†Ô∏è 500 - System Error</h1>
<p>An internal error occurred in the Aura AI system.</p>
<a href="/">‚Üê Back to System Monitor</a>
</body></html>
            ';
            add_header Content-Type text/html;
        }
    }
}
